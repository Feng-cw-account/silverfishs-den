# IES TM-30 标准中的 Rf 和 Rg 计算

在 IES TM-30 标准中，颜色保真度指标 Rf 和色域指数 Rg 的计算基于 CAM02-UCS 色彩空间，通过以下步骤实现：

## 1. 计算颜色保真度指标（IES Rf）

### 步骤：

1. **色差计算**：对每个测试样本（共99个），计算其在目标光源和参考照明体下的色差 $\Delta E_{Jab,i}$（CAM02-UCS色差）：

   $$\Delta E_{Jab,i} = \sqrt{(J'_i - J'_{\text{ref},i})^2 + (a'_i - a'_{\text{ref},i})^2 + (b'_i - b'_{\text{ref},i})^2}$$

   - $J', a', b'$：CAM02-UCS坐标，下标"ref"表示参考照明体下的值。
   - 参考照明体与目标光源色温匹配（动态参考）。

2. **平均色差**：计算所有99个样本的平均色差 $\overline{\Delta E_{Jab}}$：

   $$\overline{\Delta E_{Jab}} = \frac{1}{99} \sum_{i=1}^{99} \Delta E_{Jab,i}$$

3. **Rf值计算**：

   $$Rf = 100 - \alpha \cdot \overline{\Delta E_{Jab}}$$

   - 系数 $\alpha= 6.73$：TM-30-18版本调整后的比例因子，确保Rf=100时表示完美保真。

## 2. 计算色域指数（IES Rg）

### 步骤：

1. **色区分区**：
   - 将CAM02-UCS的$(a', b')$平面按色相角分为16个色区（每区22.5°）。
   - 每个色区内包含若干测试样本（数量不均，取决于色相分布）。

2. **计算色区均值**：
   - 对每个色区，计算目标光源和参考照明体下样本的$(a', b')$坐标均值：

     $$(a'_k, b'_k) = \frac{1}{n_k} \sum_{i \in \text{色区}k} (a'_i, b'_i)$$

     $n_k$：第k色区的样本数。

3. **构建色域多边形**：
   - 将16个色区的均值点按色相顺序连接，形成目标光源和参考照明体的色域多边形。

4. **计算面积比**：

   $$Rg = \left( \frac{A_{\text{光源}}}{A_{\text{参考}}} \right) \times 100$$

   - $A_{\text{光源}}$：目标光源色域面积。
   - $A_{\text{参考}}$：参考照明体色域面积。
   - Rg=100：表示色域与参考一致；Rg>100：色域扩大（饱和度提升）；Rg<100：色域缩小。

## 3. 关键注意事项

- **动态参考照明体**：参考光源的光谱随目标光源色温变化（如<5000K用黑体辐射，≥5000K用自然光模型），避免CIE CRI的色温突变问题。
- **色差均匀性**：CAM02-UCS的色差计算比CIELAB更符合人眼感知，尤其对高饱和度色。
- **色域形状分析**：除Rg外，TM-30还提供色域形状图，显示各色相方向的饱和度变化（如红色是否过饱和）。

## 4. 应用示例

假设测试某LED光源：

1. Rf=85：颜色保真度较好，但部分色板（如深红）可能色差较大。
2. Rg=110：整体色域扩大，但需结合色域图判断是否某些色相过度饱和（如绿色）。

## 总结

- Rf 通过CAM02-UCS色差量化颜色还原准确性，Rg 通过色域面积比评估饱和度变化。
- 16色区分区和动态参考是TM-30的核心创新，解决了传统CRI的局限性。
- 实际应用中，需结合 Rf、Rg和色域矢量图综合评估光源显色性能。

如需具体计算代码或色域绘图工具，可参考Python库"colour-science"或专业光学软件（如Lighting Passport）。
